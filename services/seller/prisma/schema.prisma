// Seller/Marketplace Service Prisma Schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/seller-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Seller {
  id                    String   @id @default(uuid())
  userId                String   @unique
  storeName             String
  slug                  String   @unique
  description           String?
  logo                  String?
  country               String?
  city                  String?
  region                String?
  phone                 String?
  website               String?
  rating                Float    @default(0)
  totalSales            Int      @default(0)
  sellerType            String   @default("INDIVIDUAL")
  logisticsOption       String   @default("HOS_FULFILLED")
  verified              Boolean  @default(false)
  customDomain          String?
  subDomain             String?
  domainPackagePurchased Boolean @default(false)
  accountNumberEnc      String?
  sortCodeEnc           String?
  accountHolderName     String?
  bankName              String?
  companyName           String?
  vatNumber             String?
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  submissions    ProductSubmission[]
  invitations    SellerInvitation[]
  reviews        ProductReview[]

  @@map("sellers")
}

model ProductSubmission {
  id              String    @id @default(uuid())
  sellerId        String
  productName     String
  productData     Json?
  status          String    @default("PENDING")
  reviewNotes     String?
  reviewedBy      String?
  reviewedAt      DateTime?
  fcAcceptedAt    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  seller Seller @relation(fields: [sellerId], references: [id])

  @@map("product_submissions")
}

model SellerInvitation {
  id          String    @id @default(uuid())
  sellerId    String?
  email       String
  token       String    @unique
  role        String    @default("SELLER")
  status      String    @default("PENDING")
  expiresAt   DateTime
  acceptedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  seller Seller? @relation(fields: [sellerId], references: [id])

  @@map("seller_invitations")
}

model ProductReview {
  id          String   @id @default(uuid())
  productId   String
  userId      String
  sellerId    String?
  rating      Int
  title       String?
  comment     String?
  isVerified  Boolean  @default(false)
  isApproved  Boolean  @default(true)
  helpfulCount Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  seller Seller? @relation(fields: [sellerId], references: [id])

  @@map("product_reviews")
}

model Theme {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  thumbnail   String?
  previewUrl  String?
  category    String?
  isPremium   Boolean  @default(false)
  price       Decimal? @db.Decimal(12, 2)
  isActive    Boolean  @default(true)
  config      Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  settings SellerThemeSettings[]

  @@map("themes")
}

model SellerThemeSettings {
  id        String   @id @default(uuid())
  sellerId  String
  themeId   String
  settings  Json?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  theme Theme @relation(fields: [themeId], references: [id])

  @@unique([sellerId, themeId])
  @@map("seller_theme_settings")
}
