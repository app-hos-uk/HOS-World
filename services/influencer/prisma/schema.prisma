// Influencer Service Prisma Schema

generator client {
  provider        = "prisma-client-js"
  output          = "../node_modules/.prisma/influencer-client"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["influencer_service"]
}

model Influencer {
  id                 String   @id @default(uuid())
  userId             String   @unique
  displayName        String?
  bio                String?
  socialLinks        Json?
  tier               String   @default("BRONZE")
  commissionRate     Decimal  @default(5) @db.Decimal(5, 2)
  isActive           Boolean  @default(true)
  totalEarnings      Decimal  @default(0) @db.Decimal(12, 2)
  totalClicks        Int      @default(0)
  totalConversions   Int      @default(0)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  storefront   InfluencerStorefront?
  productLinks InfluencerProductLink[]
  campaigns    InfluencerCampaign[]
  commissions  InfluencerCommission[]
  payouts      InfluencerPayout[]
  referrals    Referral[]

  @@map("influencers")
  @@schema("influencer_service")
}

model InfluencerStorefront {
  id           String   @id @default(uuid())
  influencerId String   @unique
  name         String
  slug         String   @unique
  description  String?
  bannerImage  String?
  logo         String?
  theme        Json?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("influencer_storefronts")
  @@schema("influencer_service")
}

model InfluencerProductLink {
  id           String   @id @default(uuid())
  influencerId String
  productId    String
  shortCode    String   @unique
  clicks       Int      @default(0)
  conversions  Int      @default(0)
  revenue      Decimal  @default(0) @db.Decimal(12, 2)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("influencer_product_links")
  @@schema("influencer_service")
}

model InfluencerCampaign {
  id           String    @id @default(uuid())
  influencerId String
  name         String
  description  String?
  startDate    DateTime?
  endDate      DateTime?
  budget       Decimal?  @db.Decimal(12, 2)
  status       String    @default("DRAFT")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("influencer_campaigns")
  @@schema("influencer_service")
}

model Referral {
  id             String    @id @default(uuid())
  influencerId   String
  referredUserId String?
  referralCode   String    @unique
  status         String    @default("PENDING")
  reward         Decimal?  @db.Decimal(12, 2)
  convertedAt    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("referrals")
  @@schema("influencer_service")
}

model InfluencerCommission {
  id           String    @id @default(uuid())
  influencerId String
  orderId      String?
  amount       Decimal   @db.Decimal(12, 2)
  rate         Decimal   @db.Decimal(5, 2)
  status       String    @default("PENDING")
  paidAt       DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("influencer_commissions")
  @@schema("influencer_service")
}

model InfluencerPayout {
  id           String    @id @default(uuid())
  influencerId String
  amount       Decimal   @db.Decimal(12, 2)
  method       String    @default("BANK_TRANSFER")
  status       String    @default("PENDING")
  reference    String?
  processedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  influencer Influencer @relation(fields: [influencerId], references: [id])

  @@map("influencer_payouts")
  @@schema("influencer_service")
}

model InfluencerInvitation {
  id          String    @id @default(uuid())
  email       String
  token       String    @unique
  status      String    @default("PENDING")
  expiresAt   DateTime
  acceptedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("influencer_invitations")
  @@schema("influencer_service")
}
